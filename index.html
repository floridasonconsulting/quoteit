<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quote-it - Professional Quote Generator</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Quote-it">
    <meta name="description" content="Create and manage professional quotes on the go">
    
    <!-- PWA Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIiByeD0iMjAiIGZpbGw9IiMzYjgyZjYiLz4KPHN2ZyB4PSI0MCIgeT0iNDAiIHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9IndoaXRlIj4KPHA+UWk8L3A+Cjwvc3ZnPgo8L3N2Zz4=">
    <link rel="manifest" href="#" id="manifest-placeholder">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" onerror="console.warn('jsPDF failed to load')"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" onerror="console.warn('html2canvas failed to load')"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" onerror="console.warn('XLSX failed to load')"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            transition: all 0.3s ease;
            overflow-x: hidden;
            position: relative;
            min-height: 100vh;
            zoom: 1 !important;
            transform: scale(1) !important;
        }
        
        /* Prevent zoom and maintain viewport */
        html {
            zoom: 1 !important;
            transform: scale(1) !important;
            overflow-x: hidden;
        }
        
        /* Ensure main content always fits viewport */
        #mainContent {
            width: 100vw;
            max-width: 100vw;
            overflow-x: hidden;
            position: relative;
            zoom: 1 !important;
            transform: scale(1) !important;
        }
        
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        /* Dark theme styles */
        .dark-theme {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            color: #ffffff;
        }
        .dark-theme * {
            color: #ffffff !important;
        }
        .dark-theme header {
            background-color: #374151;
            border-color: #4f46e5;
        }
        .dark-theme nav {
            background-color: #374151;
            border-color: #4b5563;
        }
        .dark-theme .bg-white {
            background-color: #374151 !important;
        }
        .dark-theme .bg-gray-50 {
            background-color: #4b5563 !important;
        }
        .dark-theme .bg-gray-100 {
            background-color: #6b7280 !important;
        }
        .dark-theme .border-gray-200 {
            border-color: #6b7280 !important;
        }
        .dark-theme .border-gray-300 {
            border-color: #6b7280 !important;
        }
        .dark-theme input, .dark-theme textarea, .dark-theme select {
            background-color: #4b5563 !important;
            color: #ffffff !important;
            border-color: #6b7280 !important;
        }
        .dark-theme input::placeholder, .dark-theme textarea::placeholder {
            color: #d1d5db !important;
        }
        
        /* Force light theme for quote modals and previews */
        .quote-modal, .quote-preview {
            background-color: white !important;
            color: #1f2937 !important;
        }
        .quote-modal *, .quote-preview * {
            color: #1f2937 !important;
        }
        .quote-modal .bg-white {
            background-color: white !important;
        }
        .quote-modal .bg-gray-50 {
            background-color: #f9fafb !important;
        }
        .quote-modal .bg-gray-100 {
            background-color: #f3f4f6 !important;
        }
        .quote-modal .border-gray-200 {
            border-color: #e5e7eb !important;
        }
        .quote-modal .border-gray-300 {
            border-color: #d1d5db !important;
        }
        .quote-modal input, .quote-modal textarea, .quote-modal select {
            background-color: white !important;
            color: #1f2937 !important;
            border-color: #d1d5db !important;
        }
        .quote-modal input::placeholder, .quote-modal textarea::placeholder {
            color: #9ca3af !important;
        }
        
        /* Hide scrollbar for navigation */
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-blue-500">
        <div class="px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center">
                        <!-- Calculator and Pencil Logo -->
                        <svg class="w-6 h-6 text-white" viewBox="0 0 24 24" fill="currentColor">
                            <!-- Calculator -->
                            <rect x="3" y="2" width="8" height="12" rx="1" fill="currentColor" opacity="0.8"/>
                            <rect x="4" y="4" width="6" height="2" rx="0.5" fill="white"/>
                            <circle cx="5" cy="8" r="0.5" fill="white"/>
                            <circle cx="7" cy="8" r="0.5" fill="white"/>
                            <circle cx="9" cy="8" r="0.5" fill="white"/>
                            <circle cx="5" cy="10" r="0.5" fill="white"/>
                            <circle cx="7" cy="10" r="0.5" fill="white"/>
                            <circle cx="9" cy="10" r="0.5" fill="white"/>
                            <circle cx="5" cy="12" r="0.5" fill="white"/>
                            <circle cx="7" cy="12" r="0.5" fill="white"/>
                            <circle cx="9" cy="12" r="0.5" fill="white"/>
                            <!-- Pencil -->
                            <path d="M13 3l7 7-10 10H7v-3L17 7l-4-4z" fill="currentColor" opacity="0.9"/>
                            <path d="M13 3l2 2-10 10v-2L15 3h-2z" fill="white" opacity="0.7"/>
                        </svg>
                    </div>
                    <h1 class="text-xl font-bold text-gray-800">Quote-it</h1>
                </div>
                <div class="relative">
                    <button id="menuBtn" class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors">
                        <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                    <div id="menuDropdown" class="absolute right-0 top-full mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 hidden z-50">
                        <div class="p-2">
                            <div class="px-3 py-2 text-sm font-medium text-gray-700 border-b border-gray-100">Quick Navigation</div>
                            <button class="menu-nav-btn w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg flex items-center space-x-2" data-tab="dashboard">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v6H8V5z"></path>
                                </svg>
                                <span>Dashboard</span>
                            </button>
                            <button class="menu-nav-btn w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg flex items-center space-x-2" data-tab="customers">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                </svg>
                                <span>Customers</span>
                            </button>
                            <button class="menu-nav-btn w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg flex items-center space-x-2" data-tab="items">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                                </svg>
                                <span>Items</span>
                            </button>
                            <button class="menu-nav-btn w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg flex items-center space-x-2" data-tab="quotes">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                <span>Quotes</span>
                            </button>
                            <button class="menu-nav-btn w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg flex items-center space-x-2" data-tab="settings">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                <span>Settings</span>
                            </button>
                            <div class="border-t border-gray-100 my-2"></div>
                            <button id="menuCreateQuote" class="w-full text-left px-3 py-2 text-sm text-blue-600 hover:bg-blue-50 rounded-lg flex items-center space-x-2 font-medium">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                                </svg>
                                <span>Create Quote</span>
                            </button>
                            <div class="border-t border-gray-100 my-2"></div>
                            <div class="px-3 py-2 text-sm font-medium text-gray-700">Display Theme</div>
                            <button id="lightTheme" class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg flex items-center space-x-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                                </svg>
                                <span>Light Theme</span>
                            </button>
                            <button id="darkTheme" class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-lg flex items-center space-x-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                                </svg>
                                <span>Dark Theme</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Navigation -->
    <nav class="bg-white shadow-sm border-b">
        <div class="px-2 py-2">
            <div class="flex space-x-1 overflow-x-auto scrollbar-hide">
                <button class="nav-btn active px-3 py-2 rounded-lg text-xs sm:text-sm font-medium whitespace-nowrap min-w-0 flex-shrink-0" data-tab="dashboard">Dashboard</button>
                <button class="nav-btn px-3 py-2 rounded-lg text-xs sm:text-sm font-medium whitespace-nowrap min-w-0 flex-shrink-0" data-tab="customers">Customers</button>
                <button class="nav-btn px-3 py-2 rounded-lg text-xs sm:text-sm font-medium whitespace-nowrap min-w-0 flex-shrink-0" data-tab="items">Items</button>
                <button class="nav-btn px-3 py-2 rounded-lg text-xs sm:text-sm font-medium whitespace-nowrap min-w-0 flex-shrink-0" data-tab="quotes">Quotes</button>
                <button class="nav-btn px-3 py-2 rounded-lg text-xs sm:text-sm font-medium whitespace-nowrap min-w-0 flex-shrink-0" data-tab="aging">Aging</button>
                <button class="nav-btn px-3 py-2 rounded-lg text-xs sm:text-sm font-medium whitespace-nowrap min-w-0 flex-shrink-0" data-tab="settings">Settings</button>
            </div>
        </div>
    </nav>

    <!-- Scroll to Top Button -->
    <button id="scrollToTop" class="fixed bottom-6 right-6 bg-blue-500 text-white p-3 rounded-full shadow-lg hover:bg-blue-600 transition-all transform hover:scale-110 z-40 hidden">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
        </svg>
    </button>

    <!-- Main Content -->
    <main class="px-4 py-6" id="mainContent">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content fade-in">
            <div class="space-y-6">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Quick Actions</h2>
                    <div class="grid grid-cols-1 gap-4">
                        <button id="newQuoteBtn" class="bg-gradient-to-r from-blue-500 to-indigo-600 text-white p-4 rounded-xl shadow-lg hover:shadow-xl transition-all transform hover:scale-105 flex items-center justify-center space-x-3">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                            <span class="font-semibold">Create New Quote</span>
                        </button>
                        <div class="grid grid-cols-2 gap-4">
                            <button class="nav-trigger bg-green-500 text-white p-4 rounded-xl shadow-lg hover:shadow-xl transition-all" data-tab="customers">
                                <div class="text-center">
                                    <svg class="w-8 h-8 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                    </svg>
                                    <span class="font-medium">Customers</span>
                                </div>
                            </button>
                            <button class="nav-trigger bg-purple-500 text-white p-4 rounded-xl shadow-lg hover:shadow-xl transition-all" data-tab="items">
                                <div class="text-center">
                                    <svg class="w-8 h-8 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"></path>
                                    </svg>
                                    <span class="font-medium">Items</span>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Quote Aging Overview</h3>
                    <div id="agingOverview" class="space-y-3">
                        <!-- Aging overview will be populated here -->
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Follow-Up Required</h3>
                    <div id="followUpList" class="space-y-3">
                        <!-- Follow-up items will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Customers Tab -->
        <div id="customers" class="tab-content hidden">
            <div class="space-y-4">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold text-gray-800">Customer Management</h2>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-4">
                    <div class="flex flex-wrap gap-2 mb-4">
                        <input type="text" id="customerSearch" placeholder="Search customers..." class="flex-1 min-w-0 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <button id="addCustomerBtn" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                        </button>
                        <button id="importCustomersBtn" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors text-sm">
                            📥 Import
                        </button>
                        <button id="exportCustomersBtn" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors text-sm">
                            📤 Export
                        </button>
                        <button id="deleteSelectedCustomers" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors text-sm hidden">
                            🗑️ Delete Selected
                        </button>
                    </div>
                    
                    <div class="flex items-center justify-between mb-3">
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" id="selectAllCustomers" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <span class="text-sm text-gray-600">Select All</span>
                        </label>
                        <span id="selectedCustomersCount" class="text-sm text-gray-500 hidden">0 selected</span>
                    </div>

                    <div id="customersList" class="space-y-2">
                        <!-- Customers will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Items Tab -->
        <div id="items" class="tab-content hidden">
            <div class="space-y-4">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold text-gray-800">Product/Service Items</h2>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-4">
                    <div class="flex flex-wrap gap-2 mb-4">
                        <input type="text" id="itemSearch" placeholder="Search items..." class="flex-1 min-w-0 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <button id="addItemBtn" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                        </button>
                        <button id="importItemsBtn" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors text-sm">
                            📥 Import
                        </button>
                        <button id="exportItemsBtn" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors text-sm">
                            📤 Export
                        </button>
                        <button id="deleteSelectedItems" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors text-sm hidden">
                            🗑️ Delete Selected
                        </button>
                        <button id="applyMarkupToSelected" class="bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors text-sm hidden">
                            💰 Apply Markup
                        </button>
                    </div>
                    
                    <div class="flex items-center justify-between mb-3">
                        <label class="flex items-center space-x-2">
                            <input type="checkbox" id="selectAllItems" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                            <span class="text-sm text-gray-600">Select All</span>
                        </label>
                        <span id="selectedItemsCount" class="text-sm text-gray-500 hidden">0 selected</span>
                    </div>

                    <div id="itemsList" class="space-y-2">
                        <!-- Items will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Quotes Tab -->
        <div id="quotes" class="tab-content hidden">
            <div class="space-y-4">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold text-gray-800">My Quotes</h2>
                    <button class="create-quote-btn bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg hover:bg-blue-600 transition-colors text-sm">
                        New Quote
                    </button>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-4">
                    <div id="quotesList" class="space-y-3">
                        <!-- Quotes will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Aging Tab -->
        <div id="aging" class="tab-content hidden">
            <div class="space-y-6">
                <h2 class="text-xl font-bold text-gray-800">Quote Aging Dashboard</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Aging Overview -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Aging Overview</h3>
                        <div id="agingOverviewDetailed" class="space-y-3">
                            <!-- Detailed aging overview will be populated here -->
                        </div>
                    </div>

                    <!-- Follow-Up Actions -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Action Required</h3>
                        <div id="followUpListDetailed" class="space-y-3">
                            <!-- Detailed follow-up list will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- All Sent Quotes with Aging -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">All Sent Quotes</h3>
                    <div class="mb-4">
                        <select id="agingFilter" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="all">All Quotes</option>
                            <option value="fresh">Fresh (≤7 days)</option>
                            <option value="warm">Warm (8-14 days)</option>
                            <option value="aging">Aging (15-30 days)</option>
                            <option value="stale">Stale (>30 days)</option>
                            <option value="needsFollowUp">Needs Follow-Up</option>
                        </select>
                    </div>
                    <div id="agingQuotesList" class="space-y-3">
                        <!-- Aging quotes list will be populated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content hidden">
            <div class="space-y-6">
                <h2 class="text-xl font-bold text-gray-800">Company Settings</h2>
                
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Company Information</h3>
                    <div class="space-y-4">
                        <!-- Logo Upload Section -->
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
                            <div class="text-center">
                                <div id="logoPreview" class="mb-4 hidden">
                                    <img id="logoImage" src="" alt="Company Logo" class="mx-auto max-h-24 max-w-48 object-contain">
                                </div>
                                <div id="logoPlaceholder" class="mb-4">
                                    <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                </div>
                                <div class="flex justify-center space-x-2">
                                    <label for="logoUpload" class="cursor-pointer bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors text-sm">
                                        Upload Logo
                                    </label>
                                    <button id="removeLogo" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors text-sm hidden">
                                        Remove
                                    </button>
                                </div>
                                <input type="file" id="logoUpload" accept="image/*" class="hidden">
                                <p class="text-xs text-gray-500 mt-2">PNG, JPG, GIF up to 2MB</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 gap-4">
                            <input type="text" id="companyName" placeholder="Company Name" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <textarea id="companyAddress" placeholder="Company Address" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 h-20 resize-none"></textarea>
                            <input type="tel" id="companyPhone" placeholder="Phone Number" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <input type="email" id="companyEmail" placeholder="Email Address" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <input type="url" id="companyWebsite" placeholder="Website URL" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        
                        <button id="saveCompanyInfo" class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors">
                            Save Company Information
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Quote Settings</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <label class="text-sm font-medium text-gray-700">Hide Line Item Pricing</label>
                                <p class="text-xs text-gray-500">Only show total amount in quotes</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="hideLineItemPricing" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Default Quote Terms</label>
                            <textarea id="defaultTerms" placeholder="Enter default terms and conditions..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 h-24 resize-none"></textarea>
                        </div>
                        
                        <button id="saveQuoteSettings" class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors">
                            Save Quote Settings
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Quote Creation Modal -->
    <div id="quoteModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-end justify-center min-h-screen">
            <div class="quote-modal bg-white rounded-t-2xl w-full max-w-lg max-h-[90vh] overflow-y-auto slide-up">
                <div class="sticky top-0 bg-white border-b p-4 rounded-t-2xl">
                    <div class="flex justify-between items-center">
                        <h3 id="quoteModalTitle" class="text-lg font-semibold text-gray-800">Create Quote</h3>
                        <button id="closeQuoteModal" class="p-2 hover:bg-gray-100 rounded-lg">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <div class="p-4 space-y-4">
                    <!-- Customer Selection -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Select Customer</label>
                        <select id="quoteCustomer" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="">Choose a customer...</option>
                        </select>
                    </div>

                    <!-- Quote Details -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Quote Title</label>
                        <input type="text" id="quoteTitle" placeholder="Enter quote title..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>

                    <!-- Items Selection -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Add Items</label>
                        <div class="space-y-2">
                            <div id="itemCategoriesContainer" class="border border-gray-300 rounded-lg max-h-48 overflow-y-auto">
                                <!-- Categorized items will appear here -->
                            </div>
                            <div id="selectedItems" class="space-y-2">
                                <!-- Selected items will appear here -->
                            </div>
                        </div>
                    </div>

                    <!-- Custom Item Section -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Add Custom Item</label>
                        <div class="space-y-2">
                            <input type="text" id="customItemName" placeholder="Custom item name..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <div class="flex space-x-2">
                                <input type="number" id="customItemPrice" placeholder="Price" step="0.01" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <button id="addCustomItem" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                                    Add Item
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Quote Notes -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Additional Notes</label>
                        <textarea id="quoteNotes" placeholder="Add any additional notes or terms..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 h-20 resize-none"></textarea>
                    </div>

                    <!-- Total -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="flex justify-between items-center">
                            <span class="font-semibold text-gray-700">Total Amount:</span>
                            <span id="quoteTotal" class="text-xl font-bold text-blue-600">$0.00</span>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="space-y-3 pt-4">
                        <button id="previewQuote" class="w-full bg-purple-500 text-white py-3 rounded-lg font-semibold hover:bg-purple-600 transition-colors">
                            Preview Quote
                        </button>
                        <div class="flex space-x-3">
                            <button id="saveQuote" class="flex-1 bg-blue-500 text-white py-3 rounded-lg font-semibold hover:bg-blue-600 transition-colors">
                                Save Draft
                            </button>
                            <button id="sendQuote" class="flex-1 bg-green-500 text-white py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors">
                                📧 Send Now
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Customer Modal -->
    <div id="customerModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl w-full max-w-md">
                <div class="p-4 border-b">
                    <div class="flex justify-between items-center">
                        <h3 id="customerModalTitle" class="text-lg font-semibold text-gray-800">Add Customer</h3>
                        <button class="close-modal p-2 hover:bg-gray-100 rounded-lg">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="p-4 space-y-4">
                    <input type="text" id="customerName" placeholder="Company Name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    <input type="text" id="customerContact" placeholder="Contact Person" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    <input type="email" id="customerEmail" placeholder="Email Address" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    <input type="tel" id="customerPhone" placeholder="Phone Number" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    
                    <!-- Address Section -->
                    <div class="border-t pt-4">
                        <h4 class="text-sm font-medium text-gray-700 mb-3">Physical Address (Optional)</h4>
                        <div class="space-y-3">
                            <input type="text" id="customerAddress" placeholder="Street Address" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            <div class="grid grid-cols-2 gap-3">
                                <input type="text" id="customerCity" placeholder="City" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <input type="text" id="customerState" placeholder="State/Province" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div class="grid grid-cols-2 gap-3">
                                <input type="text" id="customerZipCode" placeholder="ZIP/Postal Code" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <input type="text" id="customerCountry" placeholder="Country" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                    </div>
                    
                    <button id="saveCustomer" class="w-full bg-blue-500 text-white py-3 rounded-lg font-semibold hover:bg-blue-600 transition-colors">
                        Add Customer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Item Modal -->
    <div id="itemModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl w-full max-w-md">
                <div class="p-4 border-b">
                    <div class="flex justify-between items-center">
                        <h3 id="itemModalTitle" class="text-lg font-semibold text-gray-800">Add Item</h3>
                        <button class="close-modal p-2 hover:bg-gray-100 rounded-lg">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="p-4 space-y-4">
                    <input type="text" id="itemName" placeholder="Item Name" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    <input type="text" id="itemCategory" placeholder="Category (e.g., Web Services, Marketing)" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    <textarea id="itemDescription" placeholder="Description" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 h-20 resize-none"></textarea>
                    <input type="number" id="itemPrice" placeholder="Base Price" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    
                    <!-- Markup Section -->
                    <div class="border-t pt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Price Markup (Optional)</label>
                        <div class="space-y-2">
                            <div class="flex items-center space-x-2">
                                <input type="radio" id="markupNone" name="markupType" value="none" checked class="text-blue-600 focus:ring-blue-500">
                                <label for="markupNone" class="text-sm text-gray-700">No markup</label>
                            </div>
                            <div class="flex items-center space-x-2">
                                <input type="radio" id="markupPercent" name="markupType" value="percent" class="text-blue-600 focus:ring-blue-500">
                                <label for="markupPercent" class="text-sm text-gray-700">Percentage:</label>
                                <input type="number" id="markupPercentValue" placeholder="%" step="0.1" min="0" class="w-20 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500" disabled>
                                <span class="text-sm text-gray-500">%</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <input type="radio" id="markupFixed" name="markupType" value="fixed" class="text-blue-600 focus:ring-blue-500">
                                <label for="markupFixed" class="text-sm text-gray-700">Fixed amount:</label>
                                <input type="number" id="markupFixedValue" placeholder="0.00" step="0.01" min="0" class="w-24 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500" disabled>
                            </div>
                        </div>
                        <div id="finalPricePreview" class="mt-2 p-2 bg-blue-50 rounded text-sm text-blue-800 hidden">
                            <strong>Final Price: $<span id="finalPriceAmount">0.00</span></strong>
                        </div>
                    </div>
                    
                    <button id="saveItem" class="w-full bg-blue-500 text-white py-3 rounded-lg font-semibold hover:bg-blue-600 transition-colors">
                        Add Item
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Quote Preview Modal -->
    <div id="quotePreviewModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="quote-preview bg-white rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
                <div class="sticky top-0 bg-white border-b p-4 rounded-t-2xl flex justify-between items-center">
                    <h3 class="text-lg font-semibold text-gray-800">Quote Preview</h3>
                    <div class="flex space-x-2">
                        <button id="downloadPDF" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors text-sm">
                            📄 Download PDF
                        </button>
                        <button id="closePreviewModal" class="p-2 hover:bg-gray-100 rounded-lg">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="quotePreviewContent" class="p-8">
                    <!-- Quote content will be generated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div id="importModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl w-full max-w-md">
                <div class="p-4 border-b">
                    <div class="flex justify-between items-center">
                        <h3 id="importModalTitle" class="text-lg font-semibold text-gray-800">Import Data</h3>
                        <button class="close-modal p-2 hover:bg-gray-100 rounded-lg">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="p-4 space-y-4">
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                        <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                            <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                        <label for="importFile" class="cursor-pointer">
                            <span class="mt-2 block text-sm font-medium text-gray-900">
                                Choose Excel/CSV file to upload
                            </span>
                            <span class="mt-1 block text-xs text-gray-500">
                                Excel (.xlsx) or CSV files only
                            </span>
                        </label>
                        <input type="file" id="importFile" accept=".xlsx,.xls,.csv" class="hidden">
                    </div>
                    <div id="importInstructions" class="text-sm text-gray-600">
                        <!-- Instructions will be populated based on import type -->
                    </div>
                    <button id="processImport" class="w-full bg-green-500 text-white py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors disabled:bg-gray-300" disabled>
                        Import Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Item Markup Modal -->
    <div id="itemMarkupModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl w-full max-w-md">
                <div class="p-4 border-b">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold text-gray-800">Apply Markup</h3>
                        <button id="closeMarkupModal" class="p-2 hover:bg-gray-100 rounded-lg">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="p-4 space-y-4">
                    <!-- Item Details -->
                    <div class="bg-gray-50 p-3 rounded-lg">
                        <h4 id="markupItemName" class="font-medium text-gray-800"></h4>
                        <p id="markupItemDescription" class="text-sm text-gray-600"></p>
                        <p class="text-sm text-gray-500 mt-1">Base Price: $<span id="markupItemBasePrice">0</span></p>
                    </div>
                    
                    <!-- Markup Options -->
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Markup Type</label>
                        <div class="space-y-2">
                            <div class="flex items-center space-x-2">
                                <input type="radio" id="markupModalNone" name="markupModalType" value="none" class="text-blue-600 focus:ring-blue-500">
                                <label for="markupModalNone" class="text-sm text-gray-700">No markup</label>
                            </div>
                            <div class="flex items-center space-x-2">
                                <input type="radio" id="markupModalPercent" name="markupModalType" value="percent" class="text-blue-600 focus:ring-blue-500">
                                <label for="markupModalPercent" class="text-sm text-gray-700">Percentage:</label>
                                <input type="number" id="markupModalPercentValue" placeholder="%" step="0.1" min="0" class="w-20 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500" disabled>
                                <span class="text-sm text-gray-500">%</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <input type="radio" id="markupModalFixed" name="markupModalType" value="fixed" class="text-blue-600 focus:ring-blue-500">
                                <label for="markupModalFixed" class="text-sm text-gray-700">Fixed amount:</label>
                                <input type="number" id="markupModalFixedValue" placeholder="0.00" step="0.01" min="0" class="w-24 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500" disabled>
                            </div>
                        </div>
                        <div id="markupModalPreview" class="mt-2 p-2 bg-blue-50 rounded text-sm text-blue-800 hidden">
                            <strong>Final Price: $<span id="markupModalFinalPrice">0.00</span></strong>
                        </div>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button id="cancelMarkup" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors">
                            Cancel
                        </button>
                        <button id="applyMarkup" class="flex-1 bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors">
                            Apply Markup
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-2xl w-full max-w-md">
                <div class="p-6">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mr-4">
                            <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                            </svg>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Confirm Deletion</h3>
                            <p id="confirmMessage" class="text-sm text-gray-600 mt-1">Are you sure you want to delete this item?</p>
                        </div>
                    </div>
                    <div class="flex space-x-3">
                        <button id="confirmCancel" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors">
                            Cancel
                        </button>
                        <button id="confirmDelete" class="flex-1 bg-red-500 text-white py-2 px-4 rounded-lg hover:bg-red-600 transition-colors">
                            Delete
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Application State
        let customers = [
            { id: 1, name: "Acme Corporation", contact: "John Smith", email: "john@acme.com", phone: "(555) 123-4567", address: "123 Business Ave", city: "New York", state: "NY", zipCode: "10001", country: "USA" },
            { id: 2, name: "Tech Solutions Inc", contact: "Sarah Johnson", email: "sarah@techsol.com", phone: "(555) 987-6543", address: "456 Tech Street", city: "San Francisco", state: "CA", zipCode: "94102", country: "USA" }
        ];

        let items = [
            { id: 1, name: "Website Development", description: "Custom website design and development", price: 5000, category: "Web Services", basePrice: 5000, markupType: "none", markupValue: 0 },
            { id: 2, name: "SEO Optimization", description: "Search engine optimization package", price: 1500, category: "Marketing", basePrice: 1500, markupType: "none", markupValue: 0 },
            { id: 3, name: "Mobile App Development", description: "Native mobile application", price: 8000, category: "Development", basePrice: 8000, markupType: "none", markupValue: 0 },
            { id: 4, name: "Consulting Services", description: "Technical consulting per hour", price: 150, category: "Consulting", basePrice: 150, markupType: "none", markupValue: 0 }
        ];

        let quotes = [
            { id: 1, title: "Website Redesign Project", customer: "Acme Corporation", total: 6500, status: "Sent", date: "2024-01-15", sentDate: "2024-01-15", items: [
                { id: 1, name: "Website Development", description: "Custom website design and development", price: 5000, quantity: 1 },
                { id: 2, name: "SEO Optimization", description: "Search engine optimization package", price: 1500, quantity: 1 }
            ], notes: "Project includes 3 rounds of revisions and 6 months support.", customerInfo: { id: 1, name: "Acme Corporation", contact: "John Smith", email: "john@acme.com", phone: "(555) 123-4567" }, followUpDate: null, lastFollowUp: null }
        ];

        let companyInfo = {
            name: "Your Company Name",
            address: "",
            phone: "",
            email: "",
            website: "",
            logo: ""
        };

        let quoteSettings = {
            hideLineItemPricing: false,
            defaultTerms: "Payment terms: Net 30 days. All work subject to signed agreement."
        };

        let selectedQuoteItems = [];
        let editingQuoteId = null;
        let editingCustomerId = null;
        let editingItemId = null;
        let currentTheme = 'light';
        let currentImportType = '';
        let confirmCallback = null;
        let currentMarkupItemId = null;

        // Custom notification system
        function showNotification(message, type = 'info') {
            // Remove existing notifications
            const existingNotifications = document.querySelectorAll('.custom-notification');
            existingNotifications.forEach(notification => notification.remove());
            
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `custom-notification fixed top-4 right-4 z-50 max-w-sm p-4 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full`;
            
            // Set colors based on type
            let bgColor, textColor, icon;
            switch (type) {
                case 'success':
                    bgColor = 'bg-green-500';
                    textColor = 'text-white';
                    icon = '✅';
                    break;
                case 'error':
                    bgColor = 'bg-red-500';
                    textColor = 'text-white';
                    icon = '❌';
                    break;
                case 'warning':
                    bgColor = 'bg-yellow-500';
                    textColor = 'text-white';
                    icon = '⚠️';
                    break;
                default:
                    bgColor = 'bg-blue-500';
                    textColor = 'text-white';
                    icon = 'ℹ️';
            }
            
            notification.classList.add(bgColor, textColor);
            
            notification.innerHTML = `
                <div class="flex items-start space-x-3">
                    <span class="text-lg">${icon}</span>
                    <div class="flex-1">
                        <p class="text-sm font-medium">${message}</p>
                    </div>
                    <button class="notification-close ml-2 text-white hover:text-gray-200">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            `;
            
            // Add to DOM
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Add close functionality
            const closeBtn = notification.querySelector('.notification-close');
            closeBtn.addEventListener('click', () => {
                notification.classList.add('translate-x-full');
                setTimeout(() => notification.remove(), 300);
            });
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => notification.remove(), 300);
                }
            }, 5000);
        }

        // Custom confirmation modal functions
        function showConfirmModal(message, callback) {
            document.getElementById('confirmMessage').textContent = message;
            confirmCallback = callback;
            showModal('confirmModal');
        }

        function hideConfirmModal() {
            hideModal('confirmModal');
            confirmCallback = null;
        }

        // Markup modal functions
        function showMarkupModal(itemId) {
            const item = items.find(i => i.id === itemId);
            if (!item) return;
            
            currentMarkupItemId = itemId;
            
            // Populate item details
            document.getElementById('markupItemName').textContent = item.name;
            document.getElementById('markupItemDescription').textContent = item.description;
            document.getElementById('markupItemBasePrice').textContent = (item.basePrice || item.price).toLocaleString();
            
            // Set current markup values
            const markupType = item.markupType || 'none';
            document.querySelector(`input[name="markupModalType"][value="${markupType}"]`).checked = true;
            
            if (markupType === 'percent') {
                document.getElementById('markupModalPercentValue').value = item.markupValue || 0;
                document.getElementById('markupModalPercentValue').disabled = false;
                document.getElementById('markupModalFixedValue').disabled = true;
            } else if (markupType === 'fixed') {
                document.getElementById('markupModalFixedValue').value = item.markupValue || 0;
                document.getElementById('markupModalFixedValue').disabled = false;
                document.getElementById('markupModalPercentValue').disabled = true;
            } else {
                document.getElementById('markupModalPercentValue').disabled = true;
                document.getElementById('markupModalFixedValue').disabled = true;
                document.getElementById('markupModalPercentValue').value = '';
                document.getElementById('markupModalFixedValue').value = '';
            }
            
            updateMarkupModalPreview();
            showModal('itemMarkupModal');
        }

        function updateMarkupModalPreview() {
            const item = items.find(i => i.id === currentMarkupItemId);
            if (!item) return;
            
            const basePrice = item.basePrice || item.price;
            const markupType = document.querySelector('input[name="markupModalType"]:checked').value;
            let markupValue = 0;
            
            if (markupType === 'percent') {
                markupValue = parseFloat(document.getElementById('markupModalPercentValue').value) || 0;
            } else if (markupType === 'fixed') {
                markupValue = parseFloat(document.getElementById('markupModalFixedValue').value) || 0;
            }
            
            const finalPrice = calculateFinalPrice(basePrice, markupType, markupValue);
            const previewDiv = document.getElementById('markupModalPreview');
            const amountSpan = document.getElementById('markupModalFinalPrice');
            
            if (basePrice > 0 && markupType !== 'none' && markupValue > 0) {
                amountSpan.textContent = finalPrice.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                previewDiv.classList.remove('hidden');
            } else {
                previewDiv.classList.add('hidden');
            }
        }

        function applyItemMarkup() {
            const item = items.find(i => i.id === currentMarkupItemId);
            if (!item) return;
            
            const markupType = document.querySelector('input[name="markupModalType"]:checked').value;
            let markupValue = 0;
            
            if (markupType === 'percent') {
                markupValue = parseFloat(document.getElementById('markupModalPercentValue').value) || 0;
            } else if (markupType === 'fixed') {
                markupValue = parseFloat(document.getElementById('markupModalFixedValue').value) || 0;
            }
            
            // Store original price as base price if not already stored
            if (!item.basePrice) {
                item.basePrice = item.price;
            }
            
            item.markupType = markupType;
            item.markupValue = markupValue;
            item.price = calculateFinalPrice(item.basePrice, markupType, markupValue);
            
            renderItems();
            autoSave();
            hideModal('itemMarkupModal');
            
            const markupDescription = markupType === 'percent' ? `${markupValue}%` : 
                                    markupType === 'fixed' ? `$${markupValue}` : 'No markup';
            alert(`✅ Applied ${markupDescription} markup to "${item.name}"!`);
        }

        // Bulk Selection Functions
        function updateCustomerSelection() {
            const checkboxes = document.querySelectorAll('.customer-checkbox');
            const selectedCount = document.querySelectorAll('.customer-checkbox:checked').length;
            const totalCount = checkboxes.length;
            
            const selectAllCheckbox = document.getElementById('selectAllCustomers');
            const deleteButton = document.getElementById('deleteSelectedCustomers');
            const countDisplay = document.getElementById('selectedCustomersCount');
            
            if (selectedCount > 0) {
                deleteButton.classList.remove('hidden');
                countDisplay.classList.remove('hidden');
                countDisplay.textContent = `${selectedCount} selected`;
            } else {
                deleteButton.classList.add('hidden');
                countDisplay.classList.add('hidden');
            }
            
            if (selectedCount === totalCount && totalCount > 0) {
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else if (selectedCount > 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            } else {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            }
        }

        function updateItemSelection() {
            const checkboxes = document.querySelectorAll('.item-checkbox');
            const selectedCount = document.querySelectorAll('.item-checkbox:checked').length;
            const totalCount = checkboxes.length;
            
            const selectAllCheckbox = document.getElementById('selectAllItems');
            const deleteButton = document.getElementById('deleteSelectedItems');
            const markupButton = document.getElementById('applyMarkupToSelected');
            const countDisplay = document.getElementById('selectedItemsCount');
            
            if (selectedCount > 0) {
                deleteButton.classList.remove('hidden');
                markupButton.classList.remove('hidden');
                countDisplay.classList.remove('hidden');
                countDisplay.textContent = `${selectedCount} selected`;
            } else {
                deleteButton.classList.add('hidden');
                markupButton.classList.add('hidden');
                countDisplay.classList.add('hidden');
            }
            
            if (selectedCount === totalCount && totalCount > 0) {
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else if (selectedCount > 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            } else {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            }
        }

        function deleteSelectedCustomers() {
            const selectedIds = Array.from(document.querySelectorAll('.customer-checkbox:checked'))
                .map(cb => parseInt(cb.dataset.customerId));
            
            if (selectedIds.length === 0) return;
            
            showConfirmModal(`Are you sure you want to delete ${selectedIds.length} customer(s)?`, () => {
                customers = customers.filter(c => !selectedIds.includes(c.id));
                renderCustomers();
                autoSave();
                hideConfirmModal();
            });
        }

        function deleteSelectedItems() {
            const selectedIds = Array.from(document.querySelectorAll('.item-checkbox:checked'))
                .map(cb => parseFloat(cb.dataset.itemId)); // Use parseFloat to handle decimal IDs
            
            if (selectedIds.length === 0) return;
            
            showConfirmModal(`Are you sure you want to delete ${selectedIds.length} item(s)?`, () => {
                items = items.filter(i => {
                    // Use epsilon comparison for floating point IDs
                    return !selectedIds.some(selectedId => Math.abs(i.id - selectedId) < 0.0001);
                });
                renderItems();
                autoSave();
                hideConfirmModal();
            });
        }

        function applyMarkupToSelectedItems() {
            console.log('Apply markup to selected items function called');
            
            const selectedCheckboxes = document.querySelectorAll('.item-checkbox:checked');
            const selectedIds = Array.from(selectedCheckboxes).map(cb => {
                const id = parseFloat(cb.dataset.itemId);
                console.log('Processing checkbox with ID:', cb.dataset.itemId, 'Parsed as:', id);
                return id;
            });
            
            console.log('Selected item IDs:', selectedIds);
            console.log('Total items in array:', items.length);
            
            if (selectedIds.length === 0) {
                showNotification('No items selected. Please select items first.', 'warning');
                return;
            }
            
            // Show bulk markup modal
            showBulkMarkupModal(selectedIds);
        }

        function showBulkMarkupModal(selectedIds) {
            // Create and show bulk markup modal
            const modalHtml = `
                <div id="bulkMarkupModal" class="fixed inset-0 bg-black bg-opacity-50 z-50">
                    <div class="flex items-center justify-center min-h-screen p-4">
                        <div class="bg-white rounded-2xl w-full max-w-md">
                            <div class="p-4 border-b">
                                <div class="flex justify-between items-center">
                                    <h3 class="text-lg font-semibold text-gray-800">Apply Bulk Markup</h3>
                                    <button id="closeBulkMarkupModal" class="p-2 hover:bg-gray-100 rounded-lg">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div class="p-4 space-y-4">
                                <div class="bg-blue-50 p-3 rounded-lg">
                                    <p class="text-sm text-blue-800">Applying markup to <strong>${selectedIds.length} selected items</strong></p>
                                </div>
                                
                                <div class="space-y-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Markup Type</label>
                                    <div class="space-y-2">
                                        <div class="flex items-center space-x-2">
                                            <input type="radio" id="bulkMarkupPercent" name="bulkMarkupType" value="percent" class="text-blue-600 focus:ring-blue-500" checked>
                                            <label for="bulkMarkupPercent" class="text-sm text-gray-700">Percentage markup:</label>
                                            <input type="number" id="bulkMarkupPercentValue" placeholder="%" step="0.1" min="0" class="w-20 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500">
                                            <span class="text-sm text-gray-500">%</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <input type="radio" id="bulkMarkupFixed" name="bulkMarkupType" value="fixed" class="text-blue-600 focus:ring-blue-500">
                                            <label for="bulkMarkupFixed" class="text-sm text-gray-700">Fixed amount:</label>
                                            <input type="number" id="bulkMarkupFixedValue" placeholder="0.00" step="0.01" min="0" class="w-24 px-2 py-1 border border-gray-300 rounded text-sm focus:ring-2 focus:ring-blue-500" disabled>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="flex space-x-3">
                                    <button id="cancelBulkMarkup" class="flex-1 bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors">
                                        Cancel
                                    </button>
                                    <button id="applyBulkMarkup" class="flex-1 bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors">
                                        Apply Markup
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remove existing modal if present
            const existingModal = document.getElementById('bulkMarkupModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Add modal to DOM
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Add event listeners
            document.getElementById('closeBulkMarkupModal').addEventListener('click', () => {
                document.getElementById('bulkMarkupModal').remove();
            });
            
            document.getElementById('cancelBulkMarkup').addEventListener('click', () => {
                document.getElementById('bulkMarkupModal').remove();
            });
            
            // Radio button handlers
            document.querySelectorAll('input[name="bulkMarkupType"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const markupType = e.target.value;
                    const percentInput = document.getElementById('bulkMarkupPercentValue');
                    const fixedInput = document.getElementById('bulkMarkupFixedValue');
                    
                    if (markupType === 'percent') {
                        percentInput.disabled = false;
                        fixedInput.disabled = true;
                        fixedInput.value = '';
                    } else {
                        fixedInput.disabled = false;
                        percentInput.disabled = true;
                        percentInput.value = '';
                    }
                });
            });
            
            document.getElementById('applyBulkMarkup').addEventListener('click', () => {
                const markupType = document.querySelector('input[name="bulkMarkupType"]:checked').value;
                let markupValue = 0;
                
                if (markupType === 'percent') {
                    markupValue = parseFloat(document.getElementById('bulkMarkupPercentValue').value) || 0;
                } else {
                    markupValue = parseFloat(document.getElementById('bulkMarkupFixedValue').value) || 0;
                }
                
                if (markupValue <= 0) {
                    showNotification('Please enter a valid markup value greater than 0.', 'warning');
                    return;
                }
                
                processBulkMarkup(selectedIds, markupType, markupValue);
                document.getElementById('bulkMarkupModal').remove();
            });
        }

        function processBulkMarkup(selectedIds, markupTypeStr, markupValue) {
            
            console.log('Applying markup:', markupTypeStr, markupValue);
            
            // Apply markup to selected items with improved matching
            let updatedCount = 0;
            
            selectedIds.forEach(selectedId => {
                console.log('Looking for item with ID:', selectedId);
                
                // Find the item with exact ID match
                const itemIndex = items.findIndex(item => {
                    const match = Math.abs(item.id - selectedId) < 0.0001;
                    if (match) {
                        console.log('Found matching item:', item.name, 'ID:', item.id);
                    }
                    return match;
                });
                
                if (itemIndex !== -1) {
                    const item = items[itemIndex];
                    console.log('Updating item:', item.name, 'Original ID:', item.id, 'Selected ID:', selectedId);
                    
                    // Store original price as base price if not already stored
                    if (!item.basePrice) {
                        item.basePrice = item.price;
                    }
                    
                    const oldPrice = item.price;
                    item.markupType = markupTypeStr;
                    item.markupValue = markupValue;
                    item.price = calculateFinalPrice(item.basePrice, markupTypeStr, markupValue);
                    updatedCount++;
                    
                    console.log('Updated item price from', oldPrice, 'to', item.price);
                } else {
                    console.warn('Could not find item with ID:', selectedId);
                }
            });
            
            console.log('Successfully updated', updatedCount, 'out of', selectedIds.length, 'selected items');
            
            if (updatedCount === 0) {
                showNotification('❌ No items were updated. This might be due to ID matching issues. Please try selecting items again.', 'error');
                return;
            }
            
            // Clear all selections after applying markup
            document.querySelectorAll('.item-checkbox').forEach(cb => {
                cb.checked = false;
            });
            
            const selectAllCheckbox = document.getElementById('selectAllItems');
            if (selectAllCheckbox) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            }
            
            // Update UI
            renderItems();
            updateItemSelection();
            autoSave();
            
            const markupDescription = markupTypeStr === 'percent' ? `${markupValue}%` : `$${markupValue}`;
            showNotification(`✅ Applied ${markupDescription} markup to ${updatedCount} item(s)! All selections have been cleared.`, 'success');
        }

        // Markup calculation functions
        function calculateFinalPrice(basePrice, markupType, markupValue) {
            if (!basePrice || basePrice <= 0) return 0;
            
            switch (markupType) {
                case 'percent':
                    return basePrice * (1 + (markupValue || 0) / 100);
                case 'fixed':
                    return basePrice + (markupValue || 0);
                case 'none':
                default:
                    return basePrice;
            }
        }

        function updateItemPricePreview() {
            const basePrice = parseFloat(document.getElementById('itemPrice').value) || 0;
            const markupType = document.querySelector('input[name="markupType"]:checked').value;
            let markupValue = 0;
            
            if (markupType === 'percent') {
                markupValue = parseFloat(document.getElementById('markupPercentValue').value) || 0;
            } else if (markupType === 'fixed') {
                markupValue = parseFloat(document.getElementById('markupFixedValue').value) || 0;
            }
            
            const finalPrice = calculateFinalPrice(basePrice, markupType, markupValue);
            const previewDiv = document.getElementById('finalPricePreview');
            const amountSpan = document.getElementById('finalPriceAmount');
            
            if (basePrice > 0 && markupType !== 'none' && markupValue > 0) {
                amountSpan.textContent = finalPrice.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                previewDiv.classList.remove('hidden');
            } else {
                previewDiv.classList.add('hidden');
            }
        }

        // Quote Aging Functions
        function getQuoteAge(quote) {
            if (!quote.sentDate) return 0;
            const sentDate = new Date(quote.sentDate);
            const today = new Date();
            const diffTime = Math.abs(today - sentDate);
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }

        function getQuoteAgeCategory(age) {
            if (age <= 7) return { category: 'fresh', color: 'green', label: 'Fresh' };
            if (age <= 14) return { category: 'warm', color: 'yellow', label: 'Warm' };
            if (age <= 30) return { category: 'aging', color: 'orange', label: 'Aging' };
            return { category: 'stale', color: 'red', label: 'Stale' };
        }

        function getQuotesNeedingFollowUp() {
            const today = new Date();
            return quotes.filter(quote => {
                if (quote.status !== 'Sent') return false;
                
                // Check if follow-up date has passed
                if (quote.followUpDate) {
                    const followUpDate = new Date(quote.followUpDate);
                    return followUpDate <= today;
                }
                
                // Auto follow-up based on age
                const age = getQuoteAge(quote);
                const lastFollowUp = quote.lastFollowUp ? new Date(quote.lastFollowUp) : null;
                
                if (age >= 7 && (!lastFollowUp || (today - lastFollowUp) >= 7 * 24 * 60 * 60 * 1000)) {
                    return true;
                }
                
                return false;
            });
        }

        function markQuoteFollowedUp(quoteId) {
            const quote = quotes.find(q => q.id === quoteId);
            if (quote) {
                quote.lastFollowUp = new Date().toISOString().split('T')[0];
                quote.followUpDate = null; // Clear scheduled follow-up
                autoSave();
                renderQuotes();
                renderDashboard();
            }
        }

        function scheduleFollowUp(quoteId, date) {
            const quote = quotes.find(q => q.id === quoteId);
            if (quote) {
                quote.followUpDate = date;
                autoSave();
                renderQuotes();
                renderDashboard();
            }
        }

        function callCustomer(quoteId) {
            const quote = quotes.find(q => q.id === quoteId);
            if (quote && quote.customerInfo && quote.customerInfo.phone) {
                // Clean phone number for tel: link
                const cleanPhone = quote.customerInfo.phone.replace(/[^\d+]/g, '');
                window.location.href = `tel:${cleanPhone}`;
                
                // Mark as followed up after a short delay to allow the call to initiate
                setTimeout(() => {
                    markQuoteFollowedUp(quoteId);
                    alert(`📞 Call initiated to ${quote.customerInfo.contact} at ${quote.customerInfo.phone}\n\nFollow-up marked as complete!`);
                }, 1000);
            } else {
                alert('No phone number available for this customer.');
            }
        }

        function emailCustomerFollowUp(quoteId) {
            const quote = quotes.find(q => q.id === quoteId);
            if (quote && quote.customerInfo && quote.customerInfo.email) {
                const customer = quote.customerInfo;
                const quoteNumber = quote.id.toString().slice(-6);
                const age = getQuoteAge(quote);
                
                // Email subject
                const subject = encodeURIComponent(`Following up on Quote #${quoteNumber} - ${quote.title}`);
                
                // Email body
                const body = encodeURIComponent(`Dear ${customer.contact},

I hope this message finds you well. I wanted to follow up on the quote we sent you ${age} days ago for ${quote.title}.

Quote Details:
- Quote Number: #${quoteNumber}
- Total Amount: $${quote.total.toLocaleString()}
- Original Date: ${quote.sentDate}

I wanted to check if you had any questions about the proposal or if there's anything I can clarify for you. We're here to help and would love to discuss how we can move forward with this project.

Please feel free to reach out if you'd like to discuss any aspects of the quote or if you need any modifications.

Looking forward to hearing from you soon!

Best regards,
${companyInfo.name}
${companyInfo.phone ? `Phone: ${companyInfo.phone}` : ''}
${companyInfo.email ? `Email: ${companyInfo.email}` : ''}
${companyInfo.website ? `Website: ${companyInfo.website}` : ''}`);

                // Build mailto URL
                let mailtoUrl = `mailto:${customer.email}?subject=${subject}&body=${body}`;
                
                // Add CC if company email is provided and different from customer email
                if (companyInfo.email && companyInfo.email !== customer.email) {
                    mailtoUrl += `&cc=${encodeURIComponent(companyInfo.email)}`;
                }
                
                // Open email client
                window.location.href = mailtoUrl;
                
                // Mark as followed up after a short delay to allow the email to open
                setTimeout(() => {
                    markQuoteFollowedUp(quoteId);
                    alert(`📧 Follow-up email opened for ${customer.contact}\n\nFollow-up marked as complete!`);
                }, 1000);
            } else {
                alert('No email address available for this customer.');
            }
        }

        // Import/Export Functions
        function exportToExcel(data, filename, headers) {
            const ws = XLSX.utils.json_to_sheet(data, { header: headers });
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Sheet1");
            XLSX.writeFile(wb, filename);
        }

        function parseExcelFile(file, callback) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    callback(null, jsonData);
                } catch (error) {
                    callback(error, null);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function generateQuotePreview() {
            const customerId = document.getElementById('quoteCustomer').value;
            const title = document.getElementById('quoteTitle').value.trim();
            const notes = document.getElementById('quoteNotes').value.trim();
            
            if (!customerId || !title || selectedQuoteItems.length === 0) {
                alert('Please fill in all required fields and add at least one item.');
                return;
            }

            const customer = customers.find(c => c.id == customerId);
            const total = selectedQuoteItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const hideLineItemPricing = quoteSettings.hideLineItemPricing;
            
            const logoHtml = companyInfo.logo ? 
                `<img src="${companyInfo.logo}" alt="Company Logo" class="max-h-16 max-w-32 object-contain mb-4">` : 
                `<div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center mb-4">
                    <svg class="w-8 h-8 text-white" viewBox="0 0 24 24" fill="currentColor">
                        <rect x="3" y="2" width="8" height="12" rx="1" fill="currentColor" opacity="0.8"/>
                        <rect x="4" y="4" width="6" height="2" rx="0.5" fill="white"/>
                        <circle cx="5" cy="8" r="0.5" fill="white"/>
                        <circle cx="7" cy="8" r="0.5" fill="white"/>
                        <circle cx="9" cy="8" r="0.5" fill="white"/>
                        <circle cx="5" cy="10" r="0.5" fill="white"/>
                        <circle cx="7" cy="10" r="0.5" fill="white"/>
                        <circle cx="9" cy="10" r="0.5" fill="white"/>
                        <circle cx="5" cy="12" r="0.5" fill="white"/>
                        <circle cx="7" cy="12" r="0.5" fill="white"/>
                        <circle cx="9" cy="12" r="0.5" fill="white"/>
                        <path d="M13 3l7 7-10 10H7v-3L17 7l-4-4z" fill="currentColor" opacity="0.9"/>
                        <path d="M13 3l2 2-10 10v-2L15 3h-2z" fill="white" opacity="0.7"/>
                    </svg>
                </div>`;

            // Group items by category
            const itemsByCategory = {};
            selectedQuoteItems.forEach(item => {
                const category = item.category || 'Services';
                if (!itemsByCategory[category]) {
                    itemsByCategory[category] = [];
                }
                itemsByCategory[category].push(item);
            });

            const itemsHtml = Object.keys(itemsByCategory).sort().map(categoryName => {
                const categoryItems = itemsByCategory[categoryName];
                const categoryTotal = categoryItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                
                const categoryItemsHtml = categoryItems.map(item => {
                    const itemTotal = item.price * item.quantity;
                    return `
                        <tr class="border-b border-gray-100">
                            <td class="py-2 px-4 pl-6">
                                <div class="font-medium text-gray-900">${item.name}</div>
                                <div class="text-sm text-gray-600">${item.description}</div>
                                ${item.customText ? `<div class="text-sm text-gray-700 mt-1 italic">${item.customText}</div>` : ''}
                            </td>
                            <td class="py-2 px-2 text-center">${item.quantity}</td>
                            ${!hideLineItemPricing ? `
                                <td class="py-2 px-2 text-right">$${item.price.toLocaleString()}</td>
                                <td class="py-2 px-2 text-right font-medium">$${itemTotal.toLocaleString()}</td>
                            ` : ''}
                        </tr>
                    `;
                }).join('');

                return `
                    <tr class="bg-blue-50 border-b-2 border-blue-200">
                        <td class="py-3 px-2 font-bold text-blue-900" colspan="${hideLineItemPricing ? '2' : '4'}">
                            <div class="flex justify-between items-center">
                                <span>${categoryName}</span>
                                ${!hideLineItemPricing ? `<span class="text-blue-700">$${categoryTotal.toLocaleString()}</span>` : ''}
                            </div>
                        </td>
                    </tr>
                    ${categoryItemsHtml}
                `;
            }).join('');

            const previewHtml = `
                <div class="max-w-4xl mx-auto bg-white">
                    <!-- Header -->
                    <div class="flex justify-between items-start mb-8">
                        <div>
                            ${logoHtml}
                            <h1 class="text-2xl font-bold text-gray-900">${companyInfo.name}</h1>
                            ${companyInfo.address ? `<p class="text-gray-600">${companyInfo.address.replace(/\n/g, '<br>')}</p>` : ''}
                            ${companyInfo.phone ? `<p class="text-gray-600">${companyInfo.phone}</p>` : ''}
                            ${companyInfo.email ? `<p class="text-gray-600">${companyInfo.email}</p>` : ''}
                            ${companyInfo.website ? `<p class="text-gray-600">${companyInfo.website}</p>` : ''}
                        </div>
                        <div class="text-right">
                            <h2 class="text-3xl font-bold text-blue-600 mb-2">QUOTE</h2>
                            <p class="text-gray-600">Date: ${new Date().toLocaleDateString()}</p>
                            <p class="text-gray-600">Quote #: ${Date.now().toString().slice(-6)}</p>
                        </div>
                    </div>

                    <!-- Customer Info -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Prepared For:</h3>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p class="font-medium text-gray-900">${customer.name}</p>
                            <p class="text-gray-600">${customer.contact}</p>
                            <p class="text-gray-600">${customer.email}</p>
                            <p class="text-gray-600">${customer.phone}</p>
                            ${customer.address ? `<p class="text-gray-600 mt-2">${customer.address}</p>` : ''}
                            ${customer.city || customer.state || customer.zipCode ? `<p class="text-gray-600">${customer.city ? customer.city : ''}${customer.city && customer.state ? ', ' : ''}${customer.state ? customer.state : ''}${customer.zipCode ? ' ' + customer.zipCode : ''}</p>` : ''}
                            ${customer.country ? `<p class="text-gray-600">${customer.country}</p>` : ''}
                        </div>
                    </div>

                    <!-- Quote Title -->
                    <div class="mb-6">
                        <h3 class="text-xl font-semibold text-gray-900">${title}</h3>
                    </div>

                    <!-- Items Table -->
                    <div class="mb-8">
                        <table class="w-full">
                            <thead>
                                <tr class="bg-gray-100 border-b-2 border-gray-300">
                                    <th class="py-3 px-2 text-left font-semibold text-gray-900">Description</th>
                                    <th class="py-3 px-2 text-center font-semibold text-gray-900">Qty</th>
                                    ${!hideLineItemPricing ? `
                                        <th class="py-3 px-2 text-right font-semibold text-gray-900">Unit Price</th>
                                        <th class="py-3 px-2 text-right font-semibold text-gray-900">Total</th>
                                    ` : ''}
                                </tr>
                            </thead>
                            <tbody>
                                ${itemsHtml}
                            </tbody>
                        </table>
                    </div>

                    <!-- Total -->
                    <div class="flex justify-end mb-8">
                        <div class="w-64">
                            <div class="bg-blue-50 p-4 rounded-lg border-2 border-blue-200">
                                <div class="flex justify-between items-center">
                                    <span class="text-lg font-semibold text-gray-900">Total Amount:</span>
                                    <span class="text-2xl font-bold text-blue-600">$${total.toLocaleString()}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Notes -->
                    ${notes ? `
                        <div class="mb-8">
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Additional Notes:</h3>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <p class="text-gray-700">${notes.replace(/\n/g, '<br>')}</p>
                            </div>
                        </div>
                    ` : ''}

                    <!-- Terms -->
                    ${quoteSettings.defaultTerms ? `
                        <div class="border-t pt-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-2">Terms & Conditions:</h3>
                            <p class="text-sm text-gray-600">${quoteSettings.defaultTerms.replace(/\n/g, '<br>')}</p>
                        </div>
                    ` : ''}
                </div>
            `;

            document.getElementById('quotePreviewContent').innerHTML = previewHtml;
            showModal('quotePreviewModal');
        }

        // Navigation functionality with Viewport Reset
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // Show target tab
            const targetTab = document.getElementById(tabName);
            if (targetTab) {
                targetTab.classList.remove('hidden');
            }
            
            // Update nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-blue-500', 'text-white');
                btn.classList.add('text-gray-600', 'hover:bg-gray-100');
            });
            
            const activeBtn = document.querySelector(`[data-tab="${tabName}"].nav-btn`);
            if (activeBtn) {
                activeBtn.classList.add('active', 'bg-blue-500', 'text-white');
                activeBtn.classList.remove('text-gray-600', 'hover:bg-gray-100');
            }
            
            // Reset viewport after tab change
            setTimeout(() => {
                resetViewport();
                forceViewportReset();
            }, 50);
        }

        // Modal Management with Viewport Reset
        function showModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
            // Prevent body scroll when modal is open
            document.body.style.overflow = 'hidden';
            resetViewport();
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            // Restore body scroll when modal is closed
            document.body.style.overflow = 'auto';
            // Force viewport reset after modal closes
            setTimeout(() => {
                resetViewport();
                forceViewportReset();
            }, 100);
        }

        // Viewport Reset Functions
        function resetViewport() {
            // Reset zoom and scale
            document.documentElement.style.zoom = '1';
            document.body.style.zoom = '1';
            document.documentElement.style.transform = 'scale(1)';
            document.body.style.transform = 'scale(1)';
            
            // Reset viewport meta tag
            let viewport = document.querySelector('meta[name="viewport"]');
            if (viewport) {
                viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');
            }
            
            // Ensure main content fits
            const mainContent = document.getElementById('mainContent');
            if (mainContent) {
                mainContent.style.width = '100vw';
                mainContent.style.maxWidth = '100vw';
                mainContent.style.overflow = 'visible';
                mainContent.style.zoom = '1';
                mainContent.style.transform = 'scale(1)';
            }
        }

        function forceViewportReset() {
            // Force browser to recalculate viewport
            window.scrollTo(0, 0);
            
            // Trigger resize event to force recalculation
            window.dispatchEvent(new Event('resize'));
            
            // Additional reset for mobile browsers
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                setTimeout(() => {
                    window.scrollTo(0, 1);
                    setTimeout(() => {
                        window.scrollTo(0, 0);
                    }, 50);
                }, 100);
            }
        }

        // Quote modal functions
        function openQuoteModal(customerId = null) {
            editingQuoteId = null;
            selectedQuoteItems = [];
            updateSelectedItems();
            updateQuoteTotal();
            
            document.getElementById('quoteModalTitle').textContent = 'Create Quote';
            document.getElementById('quoteTitle').value = '';
            document.getElementById('quoteNotes').value = '';
            document.getElementById('customItemName').value = '';
            document.getElementById('customItemPrice').value = '';
            
            if (customerId) {
                document.getElementById('quoteCustomer').value = customerId;
            } else {
                document.getElementById('quoteCustomer').value = '';
            }
            
            showModal('quoteModal');
        }

        function updateSelectedItems() {
            const container = document.getElementById('selectedItems');
            container.innerHTML = selectedQuoteItems.map((item, index) => `
                <div class="bg-gray-50 p-3 rounded-lg border border-gray-200">
                    <div class="space-y-2">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h5 class="font-medium text-gray-800">${item.name}</h5>
                                <p class="text-sm text-gray-600">${item.description}</p>
                                <p class<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97e1acc265c4a516',t:'MTc1NzcwMzkxMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>